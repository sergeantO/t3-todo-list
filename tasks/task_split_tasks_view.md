# Задача: Разделение списка задач на актуальные и завершенные с возможностью свертывания

**Приоритет:** Средний  
**Статус:** Новая  
**Дата создания:** 2024

## Описание

Реализовать функциональность разделения списка задач на два отдельных раздела:
1. **Актуальные задачи** - задачи с статусом `done: false`
2. **Завершенные задачи** - задачи с статусом `done: true`

Раздел завершенных задач должен быть сворачиваемым, позволяя пользователям скрывать/показывать завершенные задачи для улучшения удобства использования интерфейса.

## Текущее состояние

Сейчас приложение отображает все задачи пользователя в одном списке без разделения по статусу выполнения. Компонент `TodoList.tsx` загружает и рендерит все задачи вместе.

## Требования

### 1. Функциональные требования

#### 1.1 Разделение списка задач
- Все задачи должны быть разделены на две группы в интерфейсе:
  - **Активные задачи** (done: false) - отображаются первыми
  - **Завершенные задачи** (done: true) - отображаются вторыми
- Каждая группа должна иметь четкий визуальный разделитель/заголовок
- Для каждой группы должно отображаться количество задач (например: "Активные (3)" / "Завершенные (2)")

#### 1.2 Функциональность свертывания
- Раздел завершенных задач должен быть сворачиваемым
- При развернутом состоянии отображаются все завершенные задачи
- При свернутом состоянии завершенные задачи скрыты, но видно их количество
- Иконка или индикатор (например, chevron/стрелка) должны показывать текущее состояние свертывания
- Состояние свертывания раздела рекомендуется сохранять в состоянии компонента (React state)

#### 1.3 Сортировка и логика отображения
- Актуальные задачи должны отображаться в порядке их создания или обновления
- Завершенные задачи должны отображаться в том же порядке внутри своего раздела
- Перемещение задачи из актуальных в завершенные должно происходить автоматически при отметке checkboxа
- Перемещение задачи из завершенных в актуальные должно происходить при снятии отметки checkboxа

### 2. Технические требования

#### 2.1 Архитектура
- **Backend изменения (минимальные)**: Текущий endpoint `todo.all` может остаться как есть - разделение выполняется на клиенте
- **Frontend изменения**: Основной компонент `TodoList.tsx` должен:
  - Отфильтровать задачи на две группы
  - Управлять состоянием свертывания раздела завершенных задач
  - Отобразить обе группы с соответствующими заголовками

#### 2.2 Компоненты
- **Рекомендуется рефакторинг** для разделения логики:
  - Создать подкомпоненты для каждого раздела (например: `ActiveTodosList`, `CompletedTodosList`)
  - Или создать вспомогательный компонент `TodosSection` для отображения раздела с заголовком и свертыванием
  - Сохранить логику оптимистичных обновлений и мутаций в основном компоненте

#### 2.3 State Management
- Использовать React `useState` для управления состоянием свертывания раздела завершенных задач
- Состояние может быть сохранено локально в компоненте `TodoList`

### 3. UI/UX требования

#### 3.1 Визуальное оформление
- Заголовок раздела должен быть четко выделен (например, жирный шрифт, больший размер)
- Использовать существующее Tailwind CSS оформление проекта
- Иконка свертывания/развертывания должна быть интуитивной (стандартная chevron-down/up)
- Завершенные задачи могут иметь визуально отличное оформление (например, сероватый цвет текста)

#### 3.2 Интерактивность
- Клик на заголовок раздела завершенных задач должен переключать состояние свертывания
- При свертывании раздел должно исчезать с плавной анимацией (рекомендуется использовать Tailwind CSS transitions)
- При развертывании раздел должно появляться с плавной анимацией

#### 3.3 Обработка граничных случаев
- Если нет активных задач - отобразить сообщение "Нет активных задач" или "Создайте первую задачу"
- Если нет завершенных задач - раздел завершенных задач может не отображаться или отображаться с сообщением "Нет завершенных задач"
- При удалении задачи - она должна автоматически исчезнуть из соответствующего раздела

### 4. Тестирование

#### 4.1 Сценарии тестирования
1. Создать задачу - она появляется в разделе "Активные задачи"
2. Отметить задачу как выполненную - она перемещается в раздел "Завершенные задачи"
3. Снять отметку с завершенной задачи - она перемещается обратно в раздел "Активные задачи"
4. Развернуть/свернуть раздел завершенных задач - видимость задач изменяется
5. Удалить задачу - она исчезает из соответствующего раздела
6. Создать несколько задач и завершить некоторые - разделы отображаются корректно с правильными счетчиками

#### 4.2 Оптимистичные обновления
- Все операции (toggle, delete) должны продолжать работать с оптимистичными обновлениями
- При ошибке операции состояние должно корректно восстанавливаться

## Иерархия изменений

### Этап 1: Рефакторинг компонентов (рекомендуется)
- Создать новый файл `TodosSection.tsx` для переиспользуемого компонента раздела
- Или создать отдельные компоненты `ActiveTodosList.tsx` и `CompletedTodosList.tsx`

### Этап 2: Модификация TodoList.tsx
- Добавить state для управления свертыванием раздела завершенных задач
- Разделить логику фильтрации задач
- Обновить JSX для отображения двух разделов

### Этап 3: UI/UX улучшения
- Добавить заголовки разделов с иконками
- Добавить счетчики задач в каждом разделе
- Добавить CSS переходы для свертывания/развертывания

### Этап 4: Тестирование
- Проверить все сценарии из раздела "Тестирование"
- Проверить оптимистичные обновления
- Проверить граничные случаи

## Принятие критериев

Функция будет считаться завершенной, когда:
- ✅ Задачи корректно разделены на две группы в интерфейсе
- ✅ Раздел завершенных задач можно свернуть/развернуть
- ✅ При перемещении задачи между разделами она автоматически перемещается в правильный раздел
- ✅ Оптимистичные обновления продолжают работать корректно
- ✅ Все граничные случаи обработаны
- ✅ Интерфейс остается интуитивным и удобным для пользователя
- ✅ Код отформатирован и соответствует стилю проекта

## Связанные файлы

- `src/app/_components/TodoList.tsx` - основной компонент для изменения
- `src/app/_components/CreateTodo.tsx` - зависит от изменений (может потребоваться обновление)
- `src/app/page.tsx` - страница, использующая компоненты
- `prisma/schema.prisma` - текущая схема БД (изменения не требуются)
- `src/server/api/routers/todo.ts` - API endpoints (минимальные/нет изменений)

## Возможные оптимизации (future work)

- Сохранение состояния свертывания в localStorage или в БД (профиль пользователя)
- Фильтрация по категориям или тегам
- Сортировка по дате создания, приоритету и т.д.
- Анимации при перемещении задач между разделами
- Пагинация для большого количества задач